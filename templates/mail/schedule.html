{% extends 'base.html' %}

{% block body %}

  <div>
    <table class="table">
      <thead>
        <tr>
          <th></th>
          <th>Subject</th>
          <th>Text</th>
          <th>Date</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for mail in schedule %}
          <tr>          
            <td></td>
            <td>
              {{ mail.subject }}
            </td>
            <td>
              {{ mail.text_body|truncatewords:10 }}
            </td>
            <td>
              {% if mail.date_sent %}
                sent at {{mail.date_sent}}
              {% else %}
              <form action="{% url mail_schedule_email mail.id %}">
                {% csrf_token %}
                <input id="id_date_{{ mail.id }}" name="scheduled_date" type="datetime" {% if mail.scheduled_date %}value="{{mail.send_date}}"{% endif %}>
              </form>
              {% endif %}
            </td>
            <td>
              <a class="btn" href="{% url mail_edit mail.id %}"><i class="icon-edit"></i> edit email</a>
              <a class="btn" href="{% url mail_delete mail.id %}"><i class="icon-trash"></i> delete email</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <a class="btn" href="{% url mail_compose %}">Create new email</a>

{% endblock %}

{% block js %}
  <script type="text/javascript">
    $(document).ready(function () {
      $('input[type=datetime]').datepicker({
          onSelect: function(date, obj) {
              $.post($(this).closest('form').attr('action'), $(this).closest('form').serialize());
          }
      });
    });
  </script>
{% endblock %}
